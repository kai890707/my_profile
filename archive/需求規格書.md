# 需求規格書：業務推廣系統後端 API

**專案代號**：業務推廣系統轉型
**文件版本**：v1.0
**建立日期**：2026-01-07
**負責角色**：PM (Product Manager)

---

## 1. 功能概述

將現有個人作品集系統轉型為業務推廣平台，提供三種角色（業務員、一般使用者、Admin）的 RESTful API 服務，專注於後端開發，供前端專案串接使用。

---

## 2. 系統角色與權限

### 2.1 業務員 (Salesperson)
- **註冊機制**：開放註冊，需管理員審核後啟用
- **核心功能**：
  - 建立/編輯個人資料（姓名、聯絡資訊、專業領域、服務地區、大頭貼）
  - 新增/編輯工作經歷
  - 新增/編輯所屬公司資訊（公司名稱、統編、產業類別）
  - 上傳證照/資格證明（儲存於資料庫）
  - 查看個人資料審核狀態

### 2.2 一般使用者 (Public User)
- **註冊機制**：不需註冊即可使用
- **核心功能**：
  - 搜尋業務員（依公司名稱、專業領域、產業類別、地區、關鍵字）
  - 查看業務員公開資料
  - （可選）註冊後查看完整聯絡資訊

### 2.3 管理員 (Admin)
- **核心功能**：
  - 使用者管理：審核業務員註冊、停用/刪除帳號
  - 內容審核：審核機敏資料（公司資訊、證照）
  - 系統設定：管理產業類別、地區選項等系統參數
  - 平台統計：查看業務員數量、搜尋統計等報表

---

## 3. 核心功能需求

### 3.1 認證與授權
- **認證機制**：JWT Token（Access Token + Refresh Token）
- **權限控制**：基於角色的存取控制（RBAC）
- **API 安全**：所有修改操作需驗證 Token

### 3.2 業務員管理
- **註冊流程**：
  1. 業務員提交註冊申請
  2. 狀態標記為「待審核」
  3. Admin 審核通過後狀態變更為「啟用」

- **資料審核機制**：
  - **首次上傳**：所有資料需審核
  - **後續修改**：
    - 機敏資料（公司名稱、統編、證照）需審核
    - 一般資料（個人簡介、技能、經歷描述）即時生效

### 3.3 搜尋功能
- **搜尋條件**：
  - 公司名稱（精確/模糊）
  - 專業領域/產業類別（多選）
  - 地區/城市（多選）
  - 關鍵字（全文搜尋：姓名、技能、經歷）

- **搜尋結果**：
  - 分頁顯示
  - 排序選項（最新註冊、評分、相關度）
  - 僅顯示已審核通過且啟用的業務員

### 3.4 檔案處理
- **儲存方式**：關聯式資料庫（BLOB 或 Base64）
- **支援檔案**：大頭貼、證照圖檔
- **檔案限制**：
  - 格式：JPG, PNG, PDF
  - 大小：5MB 以內

---

## 4. 資料庫設計重點

### 4.1 核心資料表
1. **users** - 使用者帳號（三種角色）
2. **salesperson_profiles** - 業務員個人資料
3. **companies** - 公司資訊
4. **work_experiences** - 工作經歷
5. **certifications** - 證照/資格證明
6. **industries** - 產業類別（系統設定）
7. **regions** - 地區選項（系統設定）
8. **approval_logs** - 審核紀錄

### 4.2 審核狀態設計
- 狀態欄位：`approval_status`（pending, approved, rejected）
- 審核紀錄：記錄審核者、審核時間、審核意見

---

## 5. API 端點規劃

### 5.1 認證模組
- `POST /api/auth/register` - 業務員註冊
- `POST /api/auth/login` - 登入（所有角色）
- `POST /api/auth/refresh` - 刷新 Token
- `POST /api/auth/logout` - 登出

### 5.2 業務員模組
- `GET /api/salesperson/profile` - 取得個人資料
- `PUT /api/salesperson/profile` - 更新個人資料
- `POST /api/salesperson/experiences` - 新增工作經歷
- `PUT /api/salesperson/experiences/{id}` - 更新工作經歷
- `DELETE /api/salesperson/experiences/{id}` - 刪除工作經歷
- `POST /api/salesperson/certifications` - 上傳證照
- `GET /api/salesperson/approval-status` - 查看審核狀態

### 5.3 搜尋模組（公開）
- `GET /api/search/salespersons` - 搜尋業務員
- `GET /api/search/salespersons/{id}` - 查看業務員詳細資料

### 5.4 管理員模組
- `GET /api/admin/pending-approvals` - 取得待審核清單
- `POST /api/admin/approve/{type}/{id}` - 審核通過
- `POST /api/admin/reject/{type}/{id}` - 審核拒絕
- `GET /api/admin/users` - 使用者清單
- `PUT /api/admin/users/{id}/status` - 停用/啟用帳號
- `DELETE /api/admin/users/{id}` - 刪除帳號
- `GET /api/admin/settings/industries` - 產業類別管理
- `POST /api/admin/settings/industries` - 新增產業類別
- `GET /api/admin/statistics` - 平台統計報表

---

## 6. 驗收標準

### 6.1 功能驗收
- [ ] 業務員可成功註冊，狀態為「待審核」
- [ ] Admin 可審核業務員註冊申請
- [ ] 業務員可建立/編輯個人資料、工作經歷、公司資訊
- [ ] 機敏資料修改後需審核，一般資料即時生效
- [ ] 一般使用者可透過多條件搜尋業務員
- [ ] 搜尋結果僅顯示已審核通過的業務員
- [ ] JWT Token 認證正常運作（登入、刷新、權限驗證）
- [ ] Admin 可管理使用者（停用/刪除）
- [ ] Admin 可管理系統設定（產業類別、地區）
- [ ] Admin 可查看平台統計資料

### 6.2 安全驗收
- [ ] 無 SQL Injection 漏洞
- [ ] 無 XSS 漏洞
- [ ] API 端點正確實施權限控制
- [ ] 密碼加密儲存（bcrypt）
- [ ] JWT Token 正確簽署與驗證
- [ ] 敏感資料不得洩漏（密碼、Token Secret）

### 6.3 資料驗收
- [ ] 所有資料表建立完成並包含必要欄位
- [ ] 資料關聯正確（外鍵約束）
- [ ] 審核狀態流程正確運作
- [ ] 檔案儲存於資料庫且可正常讀取

### 6.4 API 規範驗收
- [ ] 所有 API 遵循 RESTful 設計原則
- [ ] 統一的錯誤回應格式
- [ ] 統一的成功回應格式（含 data、message、status）
- [ ] API 文件完整（可使用 Postman Collection 或 OpenAPI）

---

## 7. 技術約束

- **框架**：CodeIgniter 4
- **資料庫**：MySQL 8.0
- **部署環境**：Docker
- **PHP 版本**：8.2
- **認證**：JWT（使用 firebase/php-jwt 或類似套件）

---

## 8. 非功能需求

- **效能**：搜尋 API 回應時間 < 500ms
- **安全**：遵循 OWASP Top 10 安全標準
- **擴充性**：資料庫設計支援未來擴充（如評分、留言功能）
- **文件**：提供完整 API 文件

---

## 9. 需求確認紀錄

### 9.1 關鍵決策
1. **註冊機制**：業務員開放註冊 + Admin 審核啟用
2. **搜尋條件**：公司名稱、專業領域、產業類別、地區、關鍵字（全選）
3. **API 認證**：JWT Token 機制
4. **審核機制**：首次需審核，後續僅機敏資料需審核（公司資訊、證照）
5. **機敏資料定義**：公司資訊（公司名稱、統編）、證照/資格證明
6. **一般使用者**：不需註冊即可搜尋
7. **Admin 功能**：使用者管理、內容審核、系統設定、平台統計（全選）
8. **檔案儲存**：關聯式資料庫

### 9.2 未來擴充建議
- 評分與評論功能
- 業務員推薦系統
- 訊息/詢價功能
- 多語系支援

---

**階段 1 完成：需求確認 (PM)**
**下一階段**：技術分析 (Architect)
