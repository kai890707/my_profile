module.exports=[94295,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95245),e=a.i(59501),f=a.i(56757),g=a.i(50944);function h(a,b){return a===b}var i=a.i(40695),j=a.i(5522),k=a.i(33217),l=a.i(70025),m=a.i(37927),n=a.i(23292),o=a.i(62477);async function p(a){return(await o.apiClient.get("/companies/search",{params:a})).data}async function q(a){return(await o.apiClient.post("/companies",a)).data}let r=["companies","my"];var s=a.i(84595);let t=f.z.object({tax_id:f.z.string().regex(/^\d{8}$/,"統一編號必須是 8 位數字"),name:f.z.string().min(2,"公司名稱至少需要 2 個字元").max(200,"公司名稱不能超過 200 個字元")}),u=f.z.object({name:f.z.string().min(2,"工作室名稱至少需要 2 個字元").max(200,"工作室名稱不能超過 200 個字元")});function v(){var f,o,v,w,x;let y,z,A=(0,g.useRouter)(),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(""),[F]=(f=(0,c.useRef)(D),o=(0,c.useState)({})[1],v=function(b,d,e,f){var g=this,h=(0,c.useRef)(null),i=(0,c.useRef)(0),j=(0,c.useRef)(0),k=(0,c.useRef)(null),l=(0,c.useRef)([]),m=(0,c.useRef)(),n=(0,c.useRef)(),o=(0,c.useRef)(b),p=(0,c.useRef)(!0),q=(0,c.useRef)(),r=(0,c.useRef)();o.current=b;var s=!d&&0!==d&&!1;if("function"!=typeof b)throw TypeError("Expected a function");d=+d||0;var t=!!(e=e||{}).leading,u=!("trailing"in e)||!!e.trailing,v=!!e.flushOnExit&&u,w="maxWait"in e,x="debounceOnServer"in e&&!!e.debounceOnServer,y=w?Math.max(+e.maxWait||0,d):null,z=(0,c.useMemo)(function(){var b=function(a){var b=l.current,c=m.current;return l.current=m.current=null,i.current=a,j.current=j.current||a,n.current=o.current.apply(c,b)},c=function(a,b){s&&cancelAnimationFrame(k.current),k.current=setTimeout(a,b)},e=function(a){if(!p.current)return!1;var b=a-h.current;return!h.current||b>=d||b<0||w&&a-i.current>=y},z=function(a){return k.current=null,u&&l.current?b(a):(l.current=m.current=null,n.current)},A=function a(){var b=Date.now();if(t&&j.current===i.current&&B(),e(b))return z(b);if(p.current){var f=d-(b-h.current);c(a,w?Math.min(f,y-(b-i.current)):f)}},B=function(){f&&f({})},C=function(){if(x){var f,j=Date.now(),o=e(j);if(l.current=[].slice.call(arguments),m.current=g,h.current=j,v&&!q.current&&(q.current=function(){var b;"hidden"===(null==(b=a.g.document)?void 0:b.visibilityState)&&r.current.flush()},null==(f=a.g.document)||null==f.addEventListener||f.addEventListener("visibilitychange",q.current)),o){if(!k.current&&p.current)return i.current=h.current,c(A,d),t?b(h.current):n.current;if(w)return c(A,d),b(h.current)}return k.current||c(A,d),n.current}};return C.cancel=function(){var a=k.current;a&&clearTimeout(k.current),i.current=0,l.current=h.current=m.current=k.current=null,a&&f&&f({})},C.isPending=function(){return!!k.current},C.flush=function(){return k.current?z(Date.now()):n.current},C},[t,w,d,y,u,v,s,!1,x,f]);return r.current=z,(0,c.useEffect)(function(){return p.current=!0,function(){var b;v&&r.current.flush(),q.current&&(null==(b=a.g.document)||null==b.removeEventListener||b.removeEventListener("visibilitychange",q.current),q.current=null),p.current=!1}},[v]),z}((0,c.useCallback)(function(a){f.current=a,o({})},[o]),500,void 0,o),h((w=(0,c.useRef)(D)).current,D)||(v(D),w.current=D),[f.current,v]),[G,H]=(0,c.useState)(null),I=(y=(0,g.useRouter)(),z=(0,m.useQueryClient)(),(0,l.useMutation)({mutationFn:q,onSuccess:a=>{z.invalidateQueries({queryKey:r}),z.invalidateQueries({queryKey:["salesperson","profile"]}),n.toast.success(a.message||"公司建立成功！"),y.push("/dashboard")},onError:a=>{let b=a.response?.data?.message||a.response?.data?.error||"建立失敗，請稍後再試",c=a.response?.data?.errors;c?Object.values(c).flat().forEach(a=>{n.toast.error(a)}):n.toast.error(b)}})),J=(0,s.useUpdateProfile)(),{data:K,isLoading:L}=(x={tax_id:8===F.length?F:void 0},(0,k.useQuery)({queryKey:["companies","search",x],queryFn:async()=>await p(x),enabled:!!(x.tax_id||x.name)}));(0,c.useEffect)(()=>{K&&K.exists&&K.companies.length>0?H(K.companies[0]):H(null)},[K]);let M=(0,d.useForm)({resolver:(0,e.zodResolver)(t)}),N=(0,d.useForm)({resolver:(0,e.zodResolver)(u)});return null===B?(0,b.jsx)("div",{className:"max-w-4xl mx-auto py-8 px-4",children:(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"建立公司資料"}),(0,b.jsx)("p",{className:"text-slate-600 mt-2 text-base",children:"請選擇您要建立的公司類型"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("button",{onClick:()=>C("registered"),className:"group relative flex flex-col items-center justify-center p-8 border-2 border-slate-200 rounded-2xl hover:border-primary-500 hover:bg-primary-50 transition-all",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-slate-100 group-hover:bg-primary-100 rounded-full flex items-center justify-center mb-4 transition-colors",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-slate-600 group-hover:text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,b.jsx)("h3",{className:"text-xl font-bold text-foreground mb-2",children:"註冊公司"}),(0,b.jsx)("p",{className:"text-sm text-slate-600 text-center",children:"有統一編號的正式公司"}),(0,b.jsx)("div",{className:"mt-3 px-3 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full",children:"需要統編"})]}),(0,b.jsxs)("button",{onClick:()=>C("personal"),className:"group relative flex flex-col items-center justify-center p-8 border-2 border-slate-200 rounded-2xl hover:border-primary-500 hover:bg-primary-50 transition-all",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-slate-100 group-hover:bg-primary-100 rounded-full flex items-center justify-center mb-4 transition-colors",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-slate-600 group-hover:text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,b.jsx)("h3",{className:"text-xl font-bold text-foreground mb-2",children:"個人工作室"}),(0,b.jsx)("p",{className:"text-sm text-slate-600 text-center",children:"個人經營，不需統一編號"}),(0,b.jsx)("div",{className:"mt-3 px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full",children:"無需統編"})]})]}),(0,b.jsx)("button",{onClick:()=>A.back(),className:"w-full py-3 text-sm text-slate-600 hover:text-slate-800 font-medium transition-colors",children:"取消"})]})}):"registered"===B?(0,b.jsx)("div",{className:"max-w-3xl mx-auto py-8 px-4",children:(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("button",{onClick:()=>{C(null),E(""),H(null),M.reset()},className:"inline-flex items-center text-sm text-slate-600 hover:text-slate-800 mb-4",children:[(0,b.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"返回選擇"]}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"建立註冊公司"}),(0,b.jsx)("p",{className:"text-slate-600 mt-2 text-base",children:"輸入統一編號以查詢或建立公司"})]}),(0,b.jsx)("div",{className:"bg-white border border-slate-200 rounded-xl p-8 shadow-sm",children:(0,b.jsxs)("form",{onSubmit:M.handleSubmit(a=>{I.mutate({name:a.name,tax_id:a.tax_id,is_personal:!1})}),className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Input,{label:"統一編號",type:"text",placeholder:"12345678",value:D,onChange:a=>{let b=a.target.value.replace(/\D/g,"").slice(0,8);E(b),M.setValue("tax_id",b)},error:M.formState.errors.tax_id?.message,helperText:"8 位數字",required:!0}),L&&8===D.length&&(0,b.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"搜尋中..."})]}),G&&8===D.length&&(0,b.jsx)("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-6",children:(0,b.jsxs)("div",{className:"flex items-start",children:[(0,b.jsx)("svg",{className:"h-6 w-6 text-green-600 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"找到既有公司"}),(0,b.jsxs)("div",{className:"bg-white border border-green-200 rounded-lg p-4 mb-4",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:G.name}),(0,b.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:["統編：",G.tax_id]})]}),(0,b.jsx)("p",{className:"text-sm text-green-800 mb-4",children:"此公司已存在於系統中，您可以加入此公司。"}),(0,b.jsx)(i.Button,{type:"button",onClick:()=>{G&&J.mutate({company_id:G.id})},isLoading:J.isPending,className:"w-full",children:J.isPending?"加入中...":"加入此公司"})]})]})}),!G&&8===D.length&&!L&&(0,b.jsx)("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:(0,b.jsxs)("div",{className:"flex items-start",children:[(0,b.jsx)("svg",{className:"h-6 w-6 text-blue-600 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"未找到公司"}),(0,b.jsx)("p",{className:"text-sm text-blue-800 mb-4",children:"此統編尚未在系統中註冊，請輸入公司名稱以建立新公司。"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(j.Input,{label:"公司名稱",type:"text",placeholder:"三商美邦人壽保險股份有限公司",error:M.formState.errors.name?.message,required:!0,...M.register("name")}),(0,b.jsx)(i.Button,{type:"submit",isLoading:I.isPending,className:"w-full",children:I.isPending?"建立中...":"建立公司"})]})]})]})})]})}),(0,b.jsx)("button",{onClick:()=>{C(null),E(""),H(null),M.reset()},className:"w-full py-3 text-sm text-slate-600 hover:text-slate-800 font-medium transition-colors",children:"取消"})]})}):"personal"===B?(0,b.jsx)("div",{className:"max-w-3xl mx-auto py-8 px-4",children:(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("button",{onClick:()=>{C(null),N.reset()},className:"inline-flex items-center text-sm text-slate-600 hover:text-slate-800 mb-4",children:[(0,b.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"返回選擇"]}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"建立個人工作室"}),(0,b.jsx)("p",{className:"text-slate-600 mt-2 text-base",children:"填寫您的工作室名稱"})]}),(0,b.jsx)("div",{className:"bg-white border border-slate-200 rounded-xl p-8 shadow-sm",children:(0,b.jsxs)("form",{onSubmit:N.handleSubmit(a=>{I.mutate({name:a.name,tax_id:null,is_personal:!0})}),className:"space-y-6",children:[(0,b.jsx)(j.Input,{label:"工作室名稱",type:"text",placeholder:"小明保險工作室",error:N.formState.errors.name?.message,helperText:"無需統一編號，適合個人經營",required:!0,...N.register("name")}),(0,b.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,b.jsxs)("p",{className:"text-sm text-green-800",children:[(0,b.jsx)("strong",{children:"提示："}),"個人工作室不需要統一編號，適合獨立經營的業務員使用。"]})}),(0,b.jsx)(i.Button,{type:"submit",className:"w-full text-lg font-bold tracking-wide",size:"lg",isLoading:I.isPending,children:I.isPending?"建立中...":"建立工作室"})]})}),(0,b.jsx)("button",{onClick:()=>{C(null),N.reset()},className:"w-full py-3 text-sm text-slate-600 hover:text-slate-800 font-medium transition-colors",children:"取消"})]})}):null}a.s(["default",()=>v],94295)}];

//# sourceMappingURL=app_%28dashboard%29_companies_create_page_tsx_c6fb8fa0._.js.map