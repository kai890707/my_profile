{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\n// 需要認證的路徑\nconst protectedRoutes = ['/dashboard', '/admin'];\n\n// 只有 Admin 可以訪問的路徑\nconst adminOnlyRoutes = ['/admin'];\n\n// 只有 Salesperson 可以訪問的路徑\nconst salespersonOnlyRoutes = ['/dashboard'];\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const accessToken = request.cookies.get('access_token')?.value;\n  const userRole = request.cookies.get('user_role')?.value;\n\n  // 檢查是否為受保護的路徑\n  const isProtectedRoute = protectedRoutes.some((route) => pathname.startsWith(route));\n\n  if (isProtectedRoute) {\n    // 未登入，導向登入頁\n    if (!accessToken) {\n      const loginUrl = new URL('/login', request.url);\n      // 保存原始 URL，登入後返回\n      loginUrl.searchParams.set('callbackUrl', pathname);\n      return NextResponse.redirect(loginUrl);\n    }\n\n    // 已登入，檢查角色權限\n    if (userRole) {\n      // Admin 嘗試訪問 Dashboard\n      if (adminOnlyRoutes.some((route) => pathname.startsWith(route)) && userRole !== 'admin') {\n        return NextResponse.redirect(new URL('/403', request.url));\n      }\n\n      // Salesperson 嘗試訪問 Admin\n      if (salespersonOnlyRoutes.some((route) => pathname.startsWith(route)) && userRole !== 'salesperson') {\n        return NextResponse.redirect(new URL('/403', request.url));\n      }\n    }\n  }\n\n  // 已登入用戶訪問 /login 或 /register，導向對應頁面\n  if (accessToken && (pathname === '/login' || pathname === '/register')) {\n    if (userRole === 'admin') {\n      return NextResponse.redirect(new URL('/admin', request.url));\n    } else if (userRole === 'salesperson') {\n      return NextResponse.redirect(new URL('/dashboard', request.url));\n    }\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|images|.*\\\\..*|$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,UAAU;AACV,MAAM,kBAAkB;IAAC;IAAc;CAAS;AAEhD,mBAAmB;AACnB,MAAM,kBAAkB;IAAC;CAAS;AAElC,yBAAyB;AACzB,MAAM,wBAAwB;IAAC;CAAa;AAErC,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACzD,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IAEnD,cAAc;IACd,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAC,QAAU,SAAS,UAAU,CAAC;IAE7E,IAAI,kBAAkB;QACpB,YAAY;QACZ,IAAI,CAAC,aAAa;YAChB,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,iBAAiB;YACjB,SAAS,YAAY,CAAC,GAAG,CAAC,eAAe;YACzC,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,aAAa;QACb,IAAI,UAAU;YACZ,uBAAuB;YACvB,IAAI,gBAAgB,IAAI,CAAC,CAAC,QAAU,SAAS,UAAU,CAAC,WAAW,aAAa,SAAS;gBACvF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,QAAQ,GAAG;YAC1D;YAEA,yBAAyB;YACzB,IAAI,sBAAsB,IAAI,CAAC,CAAC,QAAU,SAAS,UAAU,CAAC,WAAW,aAAa,eAAe;gBACnG,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,QAAQ,GAAG;YAC1D;QACF;IACF;IAEA,oCAAoC;IACpC,IAAI,eAAe,CAAC,aAAa,YAAY,aAAa,WAAW,GAAG;QACtE,IAAI,aAAa,SAAS;YACxB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D,OAAO,IAAI,aAAa,eAAe;YACrC,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;QAChE;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;KAOC,GACD;KACD;AACH"}}]
}