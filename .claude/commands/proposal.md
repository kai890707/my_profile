# 建立變更提案

**功能描述**: $ARGUMENTS

**任務**: 建立 OpenSpec 變更提案，明確定義需求和範圍

---

## 🔴 重要：使用需求分析專家 Agent

**所有 Proposal 階段必須使用 `requirements-analyst` agent 進行需求訪談**

```
啟動 requirements-analyst agent 進行系統化需求分析：
- 扮演 PM 角色進行需求訪談
- 系統化提問確保需求完整性
- 考慮邊界情境和異常狀況
- 輸出完整的 Proposal 文件
```

**requirements-analyst 負責**：
- ✅ 結構化需求訪談（背景、目標、使用情境）
- ✅ 釐清模糊點和矛盾
- ✅ 邊界情境分析（Edge Cases）
- ✅ 需求優先級評估（Must/Should/Could/Won't Have）
- ✅ 制定清晰驗收標準
- ✅ 識別技術風險和依賴

**工作流程**：
```
Task tool:
- subagent_type: requirements-analyst
- prompt: 進行需求訪談，分析「$ARGUMENTS」的完整需求
```

詳見：`.claude/agents/requirements-analyst.md`

---

## 目標

撰寫清晰、無歧義的變更提案，回答以下問題：
- **Why** - 為什麼需要這個變更？
- **What** - 這個變更要做什麼？
- **Scope** - 範圍是什麼（做什麼、不做什麼）？
- **Success Criteria** - 如何驗收？

---

## 工作流程

### 1. 理解需求（由 requirements-analyst agent 執行）

requirements-analyst 會使用系統化提問框架：

**必須確認的事項**:
- 功能的核心目的是什麼？
- 誰會使用這個功能？
- 有哪些使用情境？
- 有沒有技術或資源限制？
- 優先級如何？

**範例問題**:
```
Q: 這個功能的主要目標用戶是誰？
   - 選項 A: 所有使用者（公開）
   - 選項 B: 已註冊使用者
   - 選項 C: 特定角色（如 admin, salesperson）

Q: 功能的優先級？
   - 選項 A: 高（必須立即實作）
   - 選項 B: 中（2 週內完成）
   - 選項 C: 低（未來考慮）
```

### 2. 定義範圍

明確列出 In Scope（本次做）和 Out of Scope（本次不做）

**原則**:
- In Scope 必須具體、可執行
- Out of Scope 避免範圍蔓延
- 不確定的項目放 Out of Scope
- 檢閱Out of Scope是否為未來可用方案及參考實作性

**範例**:
```markdown
### In Scope (本次實作)
- ✅ 使用者可以給業務員評分（1-5 星）
- ✅ 評分需要登入認證
- ✅ 一個使用者對一個業務員只能評一次
- ✅ 顯示業務員的平均評分

### Out of Scope (未來擴充)
- ❌ 評分後的推薦演算法
- ❌ 評分通知功能
- ❌ 評分申訴機制
- ❌ 評分分析報表
```

### 3. 制定驗收標準

使用可測試、可量化的標準

**好的範例**:
- [ ] 使用者可以成功提交評分，API 回傳 201 Created
- [ ] 同一使用者對同一業務員的第二次評分會更新既有評分（不建立新記錄）
- [ ] 未登入使用者嘗試評分會收到 401 Unauthorized

**不好的範例**:
- [ ] 評分功能正常運作（太模糊）
- [ ] 使用者體驗良好（無法測試）

---

## 產出格式

產出檔案: `openspec/changes/<feature-name>/proposal.md`

### 檔案結構

```markdown
# Proposal: <功能名稱>

**Status**: Draft
**Created**: YYYY-MM-DD
**Priority**: High / Medium / Low

---

## Why (問題陳述)

[清楚說明為什麼需要這個功能]

**目前的問題**:
- 問題 1: ...
- 問題 2: ...

**影響範圍**:
- 影響的用戶: ...
- 影響的功能: ...

---

## What (解決方案)

[說明這個功能的核心內容和價值]

**功能概述**:
[1-2 句話總結功能]

**核心價值**:
- 價值 1: ...
- 價值 2: ...

**主要功能**:
1. 功能 1: 詳細說明
2. 功能 2: 詳細說明

---

## Scope (範圍)

### In Scope (本次實作)
- ✅ 項目 1
- ✅ 項目 2

### Out of Scope (未來擴充)
- ❌ 項目 3 - 原因說明
- ❌ 項目 4 - 原因說明

---

## Success Criteria (驗收標準)

功能性驗收:
- [ ] 標準 1: 具體、可測試的描述
- [ ] 標準 2: 具體、可測試的描述

非功能性驗收:
- [ ] 效能: API 回應時間 < 500ms
- [ ] 安全: 通過 OWASP Top 10 檢查
- [ ] 相容性: 支援主流瀏覽器

---

## Dependencies (相依性)

**必要的前置條件**:
- 相依系統 1: ...
- 相依功能 2: ...

**技術相依**:
- 資料庫: ...
- 第三方服務: ...

---

## Risks (風險評估)

| 風險 | 影響 | 機率 | 緩解措施 |
|------|------|------|----------|
| 風險 1 | High/Medium/Low | High/Medium/Low | 措施說明 |

---

## Open Questions (待確認問題)

- [ ] 問題 1: ...
- [ ] 問題 2: ...

**Note**: 所有問題必須在進入 Spec 階段前解決

---

**Next Step**: 使用 `/spec <feature-name>` 撰寫詳細規格
```

---

## 品質檢查清單

提案完成後，必須通過以下檢查：

### 完整性
- [ ] Why 部分清楚說明問題
- [ ] What 部分明確定義解決方案
- [ ] Scope 明確區分 In/Out
- [ ] Success Criteria 可測試

### 清晰性
- [ ] 無技術術語（或有解釋）
- [ ] 無歧義（只有一種理解方式）
- [ ] 具體而非抽象

### 可行性
- [ ] 技術上可實現
- [ ] 資源上可負擔
- [ ] 時間上合理

---

## 常見問題

### Q: Proposal 要寫多詳細？

A: 足夠詳細到讓任何人閱讀後都能理解：
- 要做什麼功能
- 為什麼要做
- 範圍有多大
- 如何驗收

**不需要**包含技術實作細節（那是 Spec 階段的事）

---

### Q: 如果不確定某些細節怎麼辦？

A: 使用 `AskUserQuestion` 工具立即詢問用戶，不要猜測。

**寧可多問，也不要憑空假設。**

---

### Q: Out of Scope 要寫多詳細？

A: 列出主要的「不做的事」即可，不用窮盡所有可能。

目的是避免範圍蔓延，讓團隊聚焦在本次要實作的內容。

---

## 使用範例

### 範例 1: 新增功能

```bash
/proposal 新增業務員評分與評論功能
```

**執行流程**:
1. 使用 AskUserQuestion 確認：
   - 評分範圍（1-5 星還是其他？）
   - 是否需要文字評論？
   - 是否需要匿名評分？
   - 權限要求（誰可以評分？）

2. 建立目錄: `openspec/changes/rating-feature/`

3. 產出 proposal.md，包含：
   - Why: 用戶需要參考其他人的評價來選擇業務員
   - What: 1-5 星評分系統 + 可選文字評論
   - Scope: In (評分、顯示) / Out (推薦、通知)
   - Success Criteria: 8 條可測試標準

---

### 範例 2: Bug 修復

```bash
/proposal 修復購物車計算錯誤
```

**執行流程**:
1. 理解 Bug:
   - 現象是什麼？
   - 重現步驟？
   - 影響範圍？

2. 建立目錄: `openspec/changes/fix-cart-calculation/`

3. 產出 proposal.md，包含：
   - Why: 購物車總價計算錯誤，影響結帳
   - What: 修正折扣計算邏輯
   - Scope: In (修正邏輯) / Out (重構整個購物車)
   - Success Criteria: 計算正確的測試案例

---

## 完成標準

Proposal 完成時必須:
- ✅ 檔案已產出到 `openspec/changes/<feature-name>/proposal.md`
- ✅ 所有必要章節都已填寫
- ✅ 無模糊或待確認的問題
- ✅ 用戶已確認需求理解正確

---

**下一步**: 使用 `/spec <feature-name>` 進入規格撰寫階段
