# OpenSpec 開發工作流程

**版本**: 2.0
**最後更新**: 2026-01-09

---

## 📊 完整工作流程圖

```
┌──────────────────────────────────────────────────────────────────────┐
│                         開始新功能開發                                │
└──────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │ 選擇開發類型         │
                    └──────────────────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            ▼                  ▼                  ▼
     ┌────────────┐    ┌────────────┐    ┌────────────┐
     │  Backend   │    │  Frontend  │    │  全棧功能  │
     │            │    │            │    │ (Backend+  │
     │ /implement │    │/implement- │    │  Frontend) │
     │            │    │  frontend  │    │            │
     └────────────┘    └────────────┘    └────────────┘
            │                  │                  │
            │                  │                  │
            └──────────────────┴──────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────┐
│                        SDD 完整流程 (6 步驟)                          │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│  Step 1: Create Proposal (建立變更提案)                              │
│  Command: /proposal [功能描述]                                       │
└──────────────────────────────────────────────────────────────────────┘
                               │
                    ┌──────────▼──────────┐
                    │ AskUserQuestion     │
                    │ 確認所有模糊問題     │
                    └─────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 產出 proposal.md    │
                    │ - Why (問題陳述)    │
                    │ - What (解決方案)   │
                    │ - Scope (範圍)      │
                    │ - Success Criteria  │
                    └─────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 用戶確認提案        │
                    │ ✅ 確認 / ❌ 修改   │
                    └─────────────────────┘
                               │
                               ▼ ✅ 確認
┌──────────────────────────────────────────────────────────────────────┐
│  Step 2: Write Specifications (撰寫詳細規格)                          │
│  Command: /spec <feature-name>                                       │
└──────────────────────────────────────────────────────────────────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            ▼                  ▼                  ▼
     ┌────────────┐    ┌────────────┐    ┌────────────┐
     │ Backend    │    │  Frontend  │    │   全棧     │
     └────────────┘    └────────────┘    └────────────┘
            │                  │                  │
            ▼                  ▼                  ▼
  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
  │ api.md          │ │ ui-ux.md        │ │ Backend +       │
  │ data-model.md   │ │ components.md   │ │ Frontend 規格   │
  │ business-rules  │ │ pages.md        │ │                 │
  │     .md         │ │ api-integration │ │                 │
  │                 │ │     .md         │ │                 │
  │                 │ │ state-routing   │ │                 │
  │                 │ │     .md         │ │                 │
  └─────────────────┘ └─────────────────┘ └─────────────────┘
            │                  │                  │
            └──────────────────┴──────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────┐
│  Step 3: Break Down Tasks (拆解實作任務)                             │
│  Command: /tasks <feature-name>                                      │
└──────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 分析規格內容        │
                    │ 識別依賴關係        │
                    │ 拆解原子任務        │
                    └─────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 產出 tasks.md       │
                    │ - 任務清單          │
                    │ - 優先級            │
                    │ - 預估工作量        │
                    │ - 驗收標準          │
                    └─────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────┐
│  Step 4: Validate Specifications (驗證規格完整性)                     │
│  Command: /validate <feature-name>                                   │
└──────────────────────────────────────────────────────────────────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            ▼                  ▼                  ▼
  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
  │ 完整性檢查      │ │ 一致性檢查      │ │ 清晰性檢查      │
  │ - 所有章節完整  │ │ - 規格無衝突    │ │ - 無歧義        │
  │ - 範例完整      │ │ - 數據類型一致  │ │ - 可直接實作    │
  │ - 驗收標準明確  │ │ - 命名一致      │ │ - 有具體範例    │
  └─────────────────┘ └─────────────────┘ └─────────────────┘
            │                  │                  │
            └──────────────────┴──────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 驗證報告            │
                    │ ✅ 通過 / ❌ 失敗   │
                    └─────────────────────┘
                               │
                               ▼ ✅ 通過
┌──────────────────────────────────────────────────────────────────────┐
│  Step 5: Implement (實作開發)                                        │
│  Command: /develop <feature-name>                                    │
└──────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 初始化 TodoWrite    │
                    │ 載入 tasks.md       │
                    └─────────────────────┘
                               │
                               ▼
               ┌───────────────────────────────┐
               │  For each task:               │
               │                               │
               │  1. 標記為 in_progress        │
               │  2. 讀取相關規格              │
               │  3. 實作程式碼                │
               │  4. 驗證功能                  │
               │  5. 標記為 completed          │
               │                               │
               │  重複直到所有任務完成         │
               └───────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 執行測試            │
                    │ /test               │
                    └─────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 測試結果            │
                    │ ✅ 通過 / ❌ 失敗   │
                    └─────────────────────┘
                               │
                               ▼ ✅ 通過
┌──────────────────────────────────────────────────────────────────────┐
│  Step 6: Archive (歸檔到規範庫)                                       │
│  Command: /archive <feature-name>                                    │
└──────────────────────────────────────────────────────────────────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            ▼                  ▼                  ▼
  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
  │ 合併 API 規格   │ │ 合併資料模型    │ │ 合併業務規則    │
  │ → endpoints.md  │ │ → data-models   │ │ → business-     │
  │                 │ │    .md          │ │    rules.md     │
  └─────────────────┘ └─────────────────┘ └─────────────────┘
            │                  │                  │
            └──────────────────┴──────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 移動到 archived/    │
                    │ openspec/changes/   │
                    │   archived/         │
                    │   <feature-name>/   │
                    └─────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 更新 CHANGELOG      │
                    │ (可選)              │
                    └─────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────┐
│                           功能開發完成 ✅                             │
│                                                                      │
│  產出:                                                               │
│  - ✅ 完整的程式碼實作                                               │
│  - ✅ 歸檔的規格文檔 (openspec/specs/)                              │
│  - ✅ 歷史變更記錄 (openspec/changes/archived/)                     │
│  - ✅ 通過的測試                                                     │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 🎯 決策流程圖

### 選擇使用哪個 Command

```
開始
  │
  ▼
第一次開發新功能？
  │
  ├─ 是 ────────────────────┐
  │                          │
  ▼                          ▼
需要完整自動化？         想要精細控制每步驟？
  │                          │
  ├─ 是                      ├─ 是
  │  ↓                       │  ↓
  │  使用 /implement         │  使用單步驟 commands
  │  或 /implement-frontend  │  (/proposal → /spec →
  │                          │   /tasks → /validate →
  │                          │   /develop → /archive)
  │                          │
  └─ 否 ───┐                 └─ 否 ───┐
           │                          │
           ▼                          ▼
     繼續已有的開發？            只想查看狀態？
           │                          │
           ├─ 是                      ├─ 是
           │  ↓                       │  ↓
           │  使用 /develop            │  使用 /status
           │  (從 tasks.md 繼續)      │
           │                          │
           └─ 否 ───┐                 └─ 否 ───┐
                    │                          │
                    ▼                          ▼
              需要測試？                  需要生成文檔？
                    │                          │
                    ├─ 是                      ├─ 是
                    │  ↓                       │  ↓
                    │  使用 /test              │  使用 /docs
                    │                          │
                    └─ 否 ───┐                 └─ 否 ───┐
                             │                          │
                             ▼                          ▼
                        功能已完成？                 參考文檔
                             │                          │
                             ├─ 是                      ▼
                             │  ↓                   README.md
                             │  使用 /archive
                             │
                             └─ 否 ───> 回到開始
```

---

## 🔄 並行開發流程

### 多功能同時開發

```
Terminal 1                Terminal 2                Terminal 3
    │                         │                         │
    ▼                         ▼                         ▼
/implement                /implement-frontend       /implement
功能 A (Backend)          功能 A (Frontend)         功能 B (Backend)
    │                         │                         │
    ▼                         ▼                         ▼
openspec/changes/         openspec/changes/         openspec/changes/
  feature-a-backend/        feature-a-frontend/       feature-b/
    │                         │                         │
    ├─ proposal.md            ├─ proposal.md            ├─ proposal.md
    ├─ specs/                 ├─ specs/                 ├─ specs/
    │   ├─ api.md             │   ├─ ui-ux.md           │   ├─ api.md
    │   ├─ data-model.md      │   ├─ components.md      │   └─ ...
    │   └─ business-rules.md  │   └─ ...                │
    └─ tasks.md               └─ tasks.md               └─ tasks.md
    │                         │                         │
    ▼                         ▼                         ▼
實作 Backend              實作 Frontend             實作 Backend
    │                         │                         │
    └─────────┬───────────────┴─────────────────────────┘
              │
              ▼
         測試整合
              │
              ▼
         全部歸檔
```

---

## 📊 狀態追蹤流程

### 使用 /status 監控進度

```
/status
  │
  ▼
掃描 openspec/changes/ 目錄
  │
  ├─ feature-a/
  │   ├─ ✅ proposal.md (完成)
  │   ├─ ✅ specs/ (完成)
  │   ├─ ✅ tasks.md (完成)
  │   ├─ 🔄 develop (進行中 - 5/10 任務)
  │   └─ ⏸️  archive (未開始)
  │
  ├─ feature-b/
  │   ├─ ✅ proposal.md (完成)
  │   ├─ 🔄 specs/ (進行中)
  │   └─ ⏸️  tasks.md (未開始)
  │
  └─ feature-c/
      └─ 🔄 proposal.md (進行中)

產出報告:
┌────────────────────────────────────────┐
│ Active Changes Summary                 │
├────────────────────────────────────────┤
│ feature-a     Implement   50%  (5/10)  │
│ feature-b     Specs       30%          │
│ feature-c     Proposal    10%          │
└────────────────────────────────────────┘
```

---

## 🧪 測試流程

### 使用 /test 執行測試

```
/test
  │
  ├─────────────┬─────────────┬─────────────┐
  │             │             │             │
  ▼             ▼             ▼             ▼
Backend      Frontend     Integration    E2E
Tests        Tests        Tests          Tests
  │             │             │             │
  ├─ PHPUnit    ├─ Vitest     ├─ API Tests  ├─ Playwright
  ├─ API Tests  ├─ React      │             │
  │             │   Testing   └─> 測試      └─> 測試
  │             │   Library      Backend      整個
  │             │                + Frontend   應用
  │             └─> 測試          整合        流程
  │                 組件
  │                 和頁面
  └─> 測試
      API 端點
      和業務邏輯

  所有測試完成
        │
        ▼
  產出測試報告
        │
  ┌─────┴─────┐
  │           │
  ▼           ▼
✅ 通過      ❌ 失敗
  │           │
  ▼           ▼
繼續流程    修復問題
            │
            └─> 重新測試
```

---

## 📚 文檔生成流程

### 使用 /docs 生成文檔

```
/docs
  │
  ▼
讀取 openspec/specs/
  │
  ├─ api/endpoints.md
  ├─ models/data-models.md
  ├─ business-rules.md
  └─ frontend/
      ├─ ui-components.md
      ├─ api-integration.md
      └─ state-routing.md
  │
  ▼
轉換為文檔格式
  │
  ├─────────────┬─────────────┬─────────────┐
  │             │             │             │
  ▼             ▼             ▼             ▼
Swagger      Markdown     HTML Site    Postman
OpenAPI       Docs         Static       Collection
  │             │             │             │
  ▼             ▼             ▼             ▼
docs/        docs/         docs/         docs/
  swagger      markdown      html          postman/
  .json        /             /             collection
               api.md        index.html    .json
               models.md
```

---

## 🎯 最佳實踐流程

### 推薦的開發流程

```
1. 規劃階段
   │
   ├─ 閱讀現有規格 (openspec/specs/)
   ├─ 了解系統架構
   └─ 確認功能範圍
   │
   ▼

2. 提案階段
   │
   ├─ 執行 /implement 或 /implement-frontend
   ├─ 使用 AskUserQuestion 確認所有問題
   ├─ 產出詳細的 proposal.md
   └─ 獲得用戶確認
   │
   ▼

3. 規格階段
   │
   ├─ 撰寫完整的技術規格
   ├─ 包含所有範例和程式碼片段
   ├─ 定義清晰的驗收標準
   └─ 通過驗證檢查 (/validate)
   │
   ▼

4. 實作階段
   │
   ├─ 使用 TodoWrite 追蹤進度
   ├─ 嚴格遵循規格
   ├─ 每個任務完成立即驗證
   └─ 持續執行測試 (/test)
   │
   ▼

5. 驗收階段
   │
   ├─ 執行完整測試套件
   ├─ 檢查所有驗收標準
   ├─ 生成文檔 (/docs)
   └─ 用戶驗收確認
   │
   ▼

6. 歸檔階段
   │
   ├─ 執行 /archive
   ├─ 合併規格到主庫
   ├─ 更新 CHANGELOG
   └─ 標記為完成 ✅
```

---

## 🚨 錯誤處理流程

### 遇到問題時的處理流程

```
遇到錯誤
  │
  ▼
錯誤發生在哪個階段？
  │
  ├─ Proposal 階段
  │  │
  │  ├─ 需求不清楚
  │  │  └─> 使用 AskUserQuestion 詢問用戶
  │  │
  │  └─ 範圍太大
  │     └─> 拆分為多個小功能
  │
  ├─ Specs 階段
  │  │
  │  ├─ 規格不完整
  │  │  └─> 執行 /validate 識別問題
  │  │      └─> 補充缺少的內容
  │  │
  │  └─ 規格有衝突
  │     └─> 檢查與現有系統的衝突
  │         └─> 修改規格或調整現有系統
  │
  ├─ Implement 階段
  │  │
  │  ├─ 實作偏離規格
  │  │  └─> 回到規格,重新實作
  │  │
  │  ├─ 測試失敗
  │  │  └─> 執行 /test 查看具體錯誤
  │  │      └─> 修復問題
  │  │      └─> 重新測試
  │  │
  │  └─ 規格有誤
  │     └─> 暫停開發
  │         └─> 修正規格
  │         └─> 繼續開發
  │
  └─ Archive 階段
     │
     └─ 規格衝突
        └─> 手動解決衝突
            └─> 更新主規範庫
            └─> 記錄決策原因
```

---

## 📝 檢查清單

### 每個階段的完成檢查清單

#### Step 1: Proposal ✅
- [ ] Why 部分清楚說明問題
- [ ] What 部分明確定義解決方案
- [ ] Scope 明確區分 In/Out
- [ ] Success Criteria 可測試
- [ ] Dependencies 已識別
- [ ] Risks 已評估
- [ ] 用戶已確認需求

#### Step 2: Specs ✅
- [ ] API 有完整 Request/Response 範例
- [ ] 資料模型有完整 Migration 程式碼
- [ ] 業務規則有明確驗證邏輯
- [ ] 所有欄位都有型別和約束
- [ ] 錯誤處理已定義
- [ ] 範例程式碼可執行

#### Step 3: Tasks ✅
- [ ] 任務已拆解為原子任務
- [ ] 任務有依賴順序
- [ ] 每個任務有驗收標準
- [ ] 工作量預估合理

#### Step 4: Validate ✅
- [ ] 完整性檢查通過
- [ ] 一致性檢查通過
- [ ] 清晰性檢查通過
- [ ] 可測性檢查通過

#### Step 5: Implement ✅
- [ ] 所有任務已完成
- [ ] 測試已通過
- [ ] 代碼符合規範
- [ ] 無已知 Bug

#### Step 6: Archive ✅
- [ ] 規格已合併到主庫
- [ ] 變更已移到 archived/
- [ ] CHANGELOG 已更新
- [ ] 文檔已生成

---

## 🔗 相關資源

- [Commands README](./README.md) - Commands 總覽和使用指南
- [CLAUDE.md](../../CLAUDE.md) - 專案開發指南
- [DEVELOPMENT_WORKFLOW_RECOMMENDATIONS.md](../../DEVELOPMENT_WORKFLOW_RECOMMENDATIONS.md) - 開發流程建議

---

**維護者**: Development Team
**最後更新**: 2026-01-09
**版本**: 2.0
